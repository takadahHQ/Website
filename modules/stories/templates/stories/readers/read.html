{% extends 'base.html' %}
{% load flag_tags %}
{% load advert_tags %}
{% load tailwind_filters %}

{% block title %}
{{ story.title | title }}
{% endblock title %}
{% block breadcrumbs %}
<li><a href="{{ story.story.story_type.get_absolute_url}}">{{ story.story.story_type.name }}</a></li> 
<li><a href="{{ story.story.get_absolute_url}}">{{ story.story.title }}</a></li> 
<li><a>{{ story.title }}</a></li> 
{% endblock %}
{% block content %}
<!-- Story Detials -->
<section class="w-full">
    <div class="bg-white dark:bg-mono-800 dark:text-mono-200">
        <div class="w-full p-8">
          <div class="btn-group w-auto">
            {% if story.get_previous %}
        <a class="btn btn-outline  w-1/3 dark:invert" href="{{ story.get_previous.get_absolute_url }}">Previous</a>
        {% else %}
        <div class="btn btn-outline  w-1/3 dark:invert" disabled="disabled">First Chapter</div>
        {% endif %}
        <div class="btn w-1/3 bg-transparent border-transparent btn-link">
          <a class="text-2xl text-center" href="{{ story.story.get_absolute_url }}"><h1 class="text-2xl card-title object-fill">{{ story.title }}</h1></a>
        </div>
        {% if story.get_next %}
        <a class="btn btn-outline  w-1/3 dark:invert" href="{{ story.get_next.get_absolute_url }}">Next</a>
        {% else %}
        <div class="btn btn-outline  w-1/3 dark:invert" disabled="disabled">Last Chapter</div>
        {% endif %}
        </div>
        </div>
        
        <div class="flex flex-col p-8">
            <div class="w-full  h-full bg-mono-50 dark:bg-mono-700 shadow-md card">
                <div class="card-body">
                  <h1 class="text-xl text-mono-800 card-title dark:text-mono-200">Chapter - {{ story.position }}: {{ story.title }}</h1>
                  <p class="text-base text-mono-600 dark:text-mono-400">{{ story.text| safe }}</p>
                </div>
              </div>
              {% if story.authors_note %}
              <div class="w-full h-full bg-mono-50 dark:bg-mono-700 shadow-md card mt-2">
                <div class="card-body">
                  <h1 class="text-xl text-mono-800 dark:text-mono-200 card-title"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
</svg>Authors Note</h1>
                  
                      <p class="text-base text-mono-600 dark:text-mono-200">{{ story.authors_note| safe }}</p>
                 
                </div>
              </div>
              {% endif %}
              <div class="p-8 align-center flex justify-evenly">
                {% render_flag_form story user request %}
                </div>
        </div>
        <div class="w-full p-8 align-center flex justify-evenly">
            {% if story.get_next %}
        <a class="btn btn-outline  w-1/3 dark:invert" href="{{ story.get_next.get_absolute_url }}">Next</a>
        {% else %}
        <div class="btn btn-outline  w-1/3 dark:invert dark:text-mono-500" disabled="disabled">Last Chapter</div>
        {% endif %}
        </div>
        </div>
</section>
{% load tailwind_filters %}
<section class="bg-mono-50 rounded shadow-mono-600 p-2 lg:p-8 mt-2 dark:bg-mono-700" id="comments">
        {% with reviewed.count as total_comments %}
<b class="text-xl dark:text-mono-50 m-2 p-8">{{ total_comments }} Comment{{ total_comments|pluralize }}</b>
        {% endwith %}
<div hx-target="#comments" hx-swap="beginafter">
<form hx-post="{% url "stories:add-review" story=story.story.id chapter=story.id %}" class="">
<div class="px-3 mb-2 mt-2 w-full">
{% csrf_token %}
        <input type="hidden" name="parent" value="{{ parent.id }}">
        <textarea name="text" placeholder="comment" class="w-full bg-mono-100 rounded border dark:bg-mono-400 border-mono-400 leading-normal resize-none h-20 py-2 px-3 font-medium placeholder-mono-700 dark:placeholder-mono-100 focus:outline-none focus:bg-white"></textarea>
    </div>
    <div class="flex justify-end px-4">
        <button type="submit" class="px-2.5 py-1.5 rounded-md text-white text-md bg-indigo-500">Comment</button>
    </div>
</form>
</div>
{{ reviewed | pprint}}
<comments id="#comments">
  {% for review in reviewed %}
    {% include "stories/partials/review.html" %}
  {% endfor %}
</comment>
</section>
{% endblock content %}