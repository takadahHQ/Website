<!-- comments.html -->
{% for comment in comments %}
  <div class="comment">
    <p>{{ comment.content }}</p>
    <div class="meta">
      <span class="author">{{ comment.user.username }}</span>
      <span class="date">{{ comment.created_at }}</span>
    </div>
    <form class="reply-form" data-feature="{{ comment.feature.id }}" data-comment="{{ comment.id }}" hx-post="{% url 'reply' %}" hx-trigger="submit" hx-target=".comments[data-feature={{ comment.feature.id }}]">
      <textarea name="content"></textarea>
      <button type="submit">Reply</button>
    </form>
    <div class="replies" data-comment="{{ comment.id }}" hx-get="{% url 'replies' comment.id %}" hx-trigger="load">
      {% for reply in comment.replies.all %}
        <div class="reply">
          <p>{{ reply.content }}</p>
          <div class="meta">
            <span class="author">{{ reply.user.username }}</span>
            <span class="date">{{ reply.created_at }}</span>
          </div>
        </div>
      {% empty %}
        <p>No replies yet.</p>
      {% endfor %}
    </div>
  </div>
{% empty %}
  <p>No comments yet.</p>
{% endfor %}
